---
import Headline from "../../../components/Headline.astro";
import DefaultLayout from "../../../layouts/DefaultLayout.astro";
import Separator from "../../../components/Separator.astro";
import CopyServerAddressButton from "../../../components/CopyServerAddressButton.astro";

//@ts-ignore
import TextLogo from "../../../assets/largehero.png?format=webp&w=1000";

import DirtTexture from "../../../assets/images/textures/dirt.png";
import PlayButtonTexture from "../../../assets/images/textures/play.png";
import PlayButtonHoverTexture from "../../../assets/images/textures/play_hover.png";

import { LINKS } from "../../../config";

//@ts-ignore
import ImageDuels from "../../../assets/images/gamemodes/1v1.png?format=webp&w=800";
//@ts-ignore
import ImageFFA from "../../../assets/images/gamemodes/FFA.png?format=webp&w=800";
//@ts-ignore
import ImageFireball from "../../../assets/images/gamemodes/fireball.png?format=webp&w=800";

const statsAPI = `https://api.mcsrvstat.us/3/${LINKS.server_address}`


let defaultMotd = "";
let defaultIcon = "";

// Debugging when server is down
if (import.meta.env.DEV) {
  defaultMotd = "             \u003Cspan style=\"color: #AAAAAA;\"\u003E&gt;&gt;---&gt;&gt; \u003C/span\u003E\u003Cspan style=\"color: #AAAAAA;\"\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF0000;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003EB\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF0A00;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Ea\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF1300;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Eg\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF1D00;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Eg\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF2700;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Ee\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF3000;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003El\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF3A00;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003E.\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF4300;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Ed\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #FF4D00;\"\u003E\u003Cspan style=\"font-weight: bold;\"\u003Ee\u003C/span\u003E\u003C/span\u003E\u003Cspan style=\"color: #AAAAAA;\"\u003E \u003C/span\u003E\u003Cspan style=\"color: #AAAAAA;\"\u003E&lt;&lt;---&lt;&lt;\u003C/span\u003E";
  defaultIcon = "data:image/png;base64,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";
}

let serverStats = {
  online: false,
  players: 0,
  maxPlayers: 0,
  motd: "",
  icon: ""
};

try {
  // const res = 0;
  const res = await fetch(statsAPI, {
    headers: {
      "User-Agent": "Baggel Server Stats Page - https://baggel.de/projects/baggel"
    }
  
  });

  if (res.ok) {
    const data = await res.json();
    serverStats = {
      online: data.online,
      players: data.players?.online ?? 0,
      maxPlayers: data.players?.max ?? 0,
      motd: data.motd?.html?.join("<br>") ?? defaultMotd,
      icon: data.icon ?? defaultIcon,
    };
  } else {
    console.warn("Failed to fetch server stats:", res.status, res.statusText);
  }
} catch (err) {
  console.error("Error fetching server stats:", err);
}

const finishedGames = [
  {
    name: "Duels 1v1",
    description:
      "Face off against another player in intense, fast-paced PvP duels. Choose your kit, sharpen your reflexes, and fight to claim victory in our arenas! Only the best will stand tall.",
    image: ImageDuels,
  },
  {
    name: "Knockback FFA",
    description:
      "No teams, no mercy! It’s every player for themselves! Jump into chaotic free-for-all combat where quick thinking and skill decide who dominates the battlefield.",
    image: ImageFFA,
  },
  {
    name: "Fireball Fight",
    description:
      "Launch, dodge, and blast your way to victory in this explosive game! Use precision and timing to knock your opponents off the map with well-aimed fireballs. One hit can change everything.",
    image: ImageFireball,
  },
];

const unfinishedGames = [
  {
    name: "Pillars of Fortune",
    description:
      "You’re stranded on a tiny pillar floating in the void. Every few seconds, fate gives you random items, sometimes helpful, sometimes deadly. Outlast everyone else in this game of pure chaos and luck!",
  },
  {
    name: "Chess",
    description:
      "The classic game of strategy, Minecraft style. Move your army across the board, plan every attack, and checkmate your opponent!",
  },
  {
    name: "TNT Run",
    description:
      "Keep moving or fall! The floor disappears beneath your feet as you run. One wrong step and it’s game over. Outlast everyone in this explosive test of reflexes and control.",
  },
  {
    name: "Baggel Clicker",
    description:
      "Every click counts! Gather coins, buy upgrades, and climb the leaderboard in this addicting idle-clicker experience inspired by Cookie Clicker, but with that Baggel flair.",
  },
  {
    name: "Replica",
    description:
      "Pay close attention! A structure appears and it’s up to you to rebuild it perfectly. Speed and precision decide who reigns as the master builder.",
  },
  {
    name: "SpeedCrafter",
    description:
      "Craft or be crafted! Race to complete random recipes as fast as you can. The faster your hands and your memory, the higher your score and bragging rights.",
  },
  {
    name: "Cow Pong",
    description:
      "Classic Pong... but with cows! Moo-ving fast is key! (I swear the cows like it!)",
  },
];
---


<DefaultLayout title="Baggel">

  <div class="max-w-5xl mx-auto px-4 sm:px-8 py-16 sm:py-20 text-text font-sans space-y-20">

    
    <img src={TextLogo} class="mx-auto h-30 md:h-80 object-cover" alt="Baggel Logo" />


    <!-- Server Stats Section -->
    <section class="stats-section max-w-xl mx-auto px-6 sm:px-8 md:px-10 text-left text-text rounded-4xl bg-linear-to-br from-background-10 to-background-10 shadow-lg border-b-4 border-background-50 py-8 transition-all duration-500 hover:shadow-2xl">
      <h2 class="text-xl sm:text-xl font-bold tracking-wide text-primary text-center mb-4">Server Status</h2>
      <ul class="space-y-2 text-base">
        <li>
          <strong>Status:</strong> 
          <span class={serverStats.online ? "text-success" : "text-error"}>
            {serverStats.online ? "Online" : "Offline"}
          </span>
        </li>
        <li><strong>Players:</strong> {serverStats.players} / {serverStats.maxPlayers}</li>
        <li class="mt-4 text-center">
          <div
            class="motd-box mt-2 inline-flex items-center gap-4 font-minecraft text-xs group"
            style={`background-image: url('${DirtTexture.src}');`}
          >
            {serverStats.icon && (
              <div class="icon-container relative w-16 h-16 shrink-0">
                <img
                  src={serverStats.icon}
                  alt="Server Icon"
                  class="icon-image w-full h-full object-cover"
                />
                <img
                  src={PlayButtonTexture.src}
                  alt="Play Button Overlay"
                  class="icon-overlay absolute inset-0 w-full h-full object-cover"
                />
                <img
                  src={PlayButtonHoverTexture.src}
                  alt="Play Button Hover Overlay"
                  class="icon-overlay-hover absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100"
                />
              </div>
            )}
            <span set:html={serverStats.motd}></span>
          </div>

        </li>

      </ul>

      <div class="mt-4 flex justify-center">
        <CopyServerAddressButton text="Kopiere Server-Adresse" copyText={LINKS.server_address} />
      </div>
    </section>

    <!-- Finished Games Section -->
    <section class="finished-games text-center">
      <h2 class="text-2xl font-bold mb-8 text-primary">Available Games</h2>

      <div class="flex flex-wrap justify-center gap-8">
        {finishedGames.map((game) => (
          <div class="w-full sm:w-[45%] lg:w-[45%] max-w-xl group relative rounded-2xl overflow-hidden bg-background-10 border border-background-50 hover:border-accent transition-all duration-500 shadow-lg hover:shadow-2xl">
            <img
              src={game.image}
              alt={game.name}
              class="w-full h-48 object-cover opacity-80 group-hover:opacity-100 transition-opacity duration-500"
            />
            <div class="p-6 text-left space-y-2">
              <h3 class="text-xl font-bold text-primary">{game.name}</h3>
              <p class="text-text-50">{game.description}</p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <Separator/>

    <!-- Coming Soon Section -->
    <section class="unfinished-games text-center">
      <h2 class="text-2xl font-bold mb-8 text-primary">Coming Soon</h2>

      <div class="flex flex-wrap justify-center gap-8">
        {unfinishedGames.map((game) => (
          <div class="w-full sm:w-[45%] lg:w-[45%] max-w-xl group relative rounded-2xl overflow-hidden bg-background-10 border border-background-50 hover:border-accent transition-all duration-500 shadow-lg hover:shadow-2xl">
            <div class="absolute bottom-4 right-4 bg-accent/20 text-accent text-xs font-semibold px-2 py-1 rounded-md backdrop-blur-sm border border-accent/30">
              In Development
            </div>

            <div class="p-6 text-left space-y-2 mb-8">
              <h3 class="text-xl font-bold text-primary">{game.name}</h3>
              <p class="text-text-50">{game.description}</p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Development Notice -->
    <section class="text-center max-w-2xl mx-auto">
      <Separator/>
      <p class="text-text-50 text-base">
        Our server is currently in <span class="text-accent font-semibold">active development</span>.<br />
        New game modes and features are being added all the time. Stay tuned!
      </p>
    </section>

  </div>

</DefaultLayout>

<style>
.motd-box {
  position: relative;
  background-repeat: repeat;
  background-size: 64px 64px;
  image-rendering: pixelated;
  border: 2px solid #fff;
  padding: 1rem;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  line-height: 1.5;
  overflow: hidden;
  z-index: 0;
}

.motd-box::after {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.75);
  pointer-events: none;
  z-index: 1;
}

.motd-box > * {
  position: relative;
  z-index: 2;
}

.icon-container {
  position: relative;
  width: 64px;
  height: 64px;
  overflow: hidden;
  image-rendering: pixelated;
  cursor: pointer;
}

/* White overlay */
.icon-container::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.25);
  opacity: 0;
  z-index: 1;
}

/* Overlay hover */
.group:hover .icon-container::before {
  opacity: 1;
}

/* Base icon */
.icon-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  position: relative;
  z-index: 0;
}

/* Overlay textures */
.icon-overlay,
.icon-overlay-hover {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  pointer-events: none;
  z-index: 2; /* above white overlay */
}

.icon-overlay {
  opacity: 0;
}

.icon-overlay-hover {
  opacity: 0;
}

/* Show play texture */
.group:hover .icon-overlay {
  opacity: 1;
}

/* Swap texture */
.group:hover .icon-container:hover .icon-overlay {
  opacity: 0;
}
.group:hover .icon-container:hover .icon-overlay-hover {
  opacity: 1;
}


</style>
